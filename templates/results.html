{% extends "base.html" %}

{% block content %}
<div id="userSection" class="container">
    <!-- Displaying resuts here -->
    {% if results %}
    <h2>{{session.drill_type}} Results</h2>
    <div class="card-container">
        <p><strong>User Id: </strong>{{ user.user_id}}</p>
        <p><strong>Name: </strong>{{ user.first_name }} {{ user.last_name }}</p>
        <p><strong>Session Id: </strong>{{ session.id }}</p>
        <p><strong>Start Time: </strong>{{ session.start_time.strftime('%b %d, %Y %I:%M %p') if session.start_time else 'N/A' }}</p>
        <p><strong>End Time: </strong>{{ session.end_time.strftime('%b %d, %Y %I:%M %p') if session.end_time else 'Ongoing' }}</p>
        <p><strong>Status: </strong>{{ 'Active' if session.active else 'Inactive' }}</p>
    </div>
    <table class="user-table results-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Timestamp</th>
                <th>Status</th>
                <th>Suggestion</th>
                <th>Angles</th>
                <th>Screenshot</th>
            </tr>
        </thead>
        <tbody>
            {% for result in results %}
            <tr class="{{ 'bg-green-50' if result.status == 'Salute is Correct' else 'bg-red-50' }}">
                <td>{{ loop.index }}</td>
                <td>{{ result.timestamp }}</td>
                <td class="font-semibold {{ 'text-green-600' if result.status == 'Salute is Correct' else 'text-red-600' }}">
                    {{ result.status }}
                </td>
                <td>{{ result.suggestion }}</td>
                <td>{{ result.angle }}</td>
                <td>
                    {% if result.screenshot_path %}
                    <a href="{{ url_for('static', filename=result.screenshot_path.split('static\\')[-1]) }}" target="_blank">
                        <img src="{{ url_for('static', filename=result.screenshot_path.split('static\\')[-1]) }}"
                            alt="Screenshot" style="height: 60px; border-radius: 4px;">
                    </a>
                    {% else %}
                    N/A
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>

    </table>
    {% elif user and session %}
    <h2>{{session.drill_type}} Results</h2>
    <p>
        No Results are available for now
    </p>
    {% endif %}
    <!-- Displaying User Sessions Here -->
    {% if sessions %}
    <h2>User Sessions</h2>
    <div class="card-container">
        <p><strong>User Id: </strong>{{ user.user_id}}</p>
        <p><strong>Name: </strong>{{ user.first_name }} {{ user.last_name }}</p>
    </div>
    <table class="user-table results-table">
        <thead>
            <tr>
                <th></th>
                <th>Session Id</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Drill Type</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="userList">
            {% for session in sessions %}
            <tr>
                <td>
                    <i class="fas fa-user"></i>
                </td>
                <td>
                    <h3>{{ session.id }}</h3>
                </td>
                <td>
                    <p>{{ session.start_time.strftime('%b %d, %Y %I:%M %p') if session.start_time else 'N/A' }}</p>
                </td>
                <td>
                    <p>{{ session.end_time.strftime('%b %d, %Y %I:%M %p') if session.end_time else 'Ongoing' }}</p>
                </td>

                <td>
                    <p>{{session.drill_type}}</p>
                </td>
                <td>
                    <p>{{ 'Active' if session.active else 'Inactive' }}</p>
                </td>
                <td>
                    <a class="btn btn-custom" style="max-width: fit-content;" href="{{url_for('results', user_id=user.user_id, session_id=session.id, drill_slug=session.drill_type) }}">
                        <p>View Results</p>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% elif users is none and results is none %}
    <h2>User Sessions</h2>
    <p>
        No User Sessions are available
    </p>
    {% endif %}



    <!-- Displaying Users here -->
    {% if users %}
    <h2>Users Results</h2>
    <table class="user-table results-table">
        <thead>
            <tr>
                <th></th>
                <th>Name</th>
                <th>User ID</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="userList">
            {% for user in users %}
            <tr>
                <td>
                    <i class="fas fa-user"></i>
                </td>
                <td>
                    <h3>{{ user.first_name }} {{ user.last_name }}</h3>
                </td>
                <td>
                    <p>{{user.user_id}}</p>
                </td>
                <td>
                    <a class="btn btn-custom" style="max-width: fit-content;" href="{{url_for('results', user_id=user.user_id) }}">
                        <p>View Sessions</p>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% elif user is none %}
    <h2>Users Results</h2>
    <p>
        No Users are available
    </p>
    {% endif %}
</div>
{% endblock %}